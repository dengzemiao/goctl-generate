# ============================================
# Go-Zero 数据库配置示例
# ============================================
# 此文件展示如何配置不同类型的数据库连接
# 选择对应的配置格式复制到你的配置文件中

# ============================================
# 方式一：推荐格式（统一配置）
# ============================================
# 优点：结构清晰，支持自动检测数据库类型
# 使用：适合新项目或需要支持多种数据库的项目

Database:
  Type: mysql          # 数据库类型: mysql, postgres, mongo
  DataSource: "root:123456@tcp(127.0.0.1:3306)/mydb"

# ============================================
# 方式二：MySQL 专用格式
# ============================================
# 使用：MySQL 数据库项目

MySQL:
  DataSource: "root:password@tcp(127.0.0.1:3306)/database_name"
  # DSN 格式说明：
  # - user: 数据库用户名
  # - password: 数据库密码
  # - host: 数据库主机地址
  # - port: 数据库端口（MySQL 默认 3306）
  # - database_name: 数据库名称
  # 注意：不要添加 ?charset=utf8mb4 等参数

# ============================================
# 方式三：PostgreSQL 专用格式
# ============================================
# 使用：PostgreSQL 数据库项目

Postgres:
  DataSource: "postgres://username:password@localhost:5432/database_name"
  # 或者使用简化格式：
  # DataSource: "user:password@localhost:5432/database_name"
  # DSN 格式说明：
  # - username: 数据库用户名
  # - password: 数据库密码
  # - localhost: 数据库主机地址
  # - 5432: 数据库端口（PostgreSQL 默认 5432）
  # - database_name: 数据库名称

# ============================================
# 方式四：MongoDB 专用格式
# ============================================
# 使用：MongoDB 数据库项目

Mongo:
  DataSource: "mongodb://username:password@localhost:27017/database_name"
  # DSN 格式说明：
  # - username: 数据库用户名
  # - password: 数据库密码
  # - localhost: 数据库主机地址
  # - 27017: 数据库端口（MongoDB 默认 27017）
  # - database_name: 数据库名称

# ============================================
# 完整配置示例（包含其他配置项）
# ============================================

Name: example-api
Host: 0.0.0.0
Port: 8888

# 数据库配置
Database:
  Type: mysql
  DataSource: "root:123456@tcp(127.0.0.1:3306)/mydb"

# JWT 配置
Auth:
  AccessSecret: your-access-secret-key
  AccessExpire: 7200

# 日志配置
Log:
  ServiceName: example-api
  Mode: console
  Level: info

# ============================================
# 使用说明
# ============================================
# 1. 根据你的数据库类型选择对应的配置格式
# 2. 修改 DataSource 中的连接信息（用户名、密码、主机、端口、数据库名）
# 3. 将配置复制到你的配置文件中（如 etc/test-api.yaml）
# 4. 运行生成脚本：
#    - Model 生成: sh generate/model.sh
#    - API 生成:   sh generate/api.sh

# ============================================
# Model 生成脚本使用
# ============================================
# 基本用法：
#   sh generate/model.sh                    # 生成所有表（MySQL）
#   sh generate/model.sh --db-type postgres # 使用 PostgreSQL
#   sh generate/model.sh -t user,order      # 仅生成指定表
#   sh generate/model.sh --dry-run          # 预览模式
#
# 常用参数：
#   -c, --config FILE    指定配置文件（默认: etc/test-api.yaml）
#   -o, --output DIR     指定输出目录（默认: internal/model）
#   -s, --style STYLE    指定命名风格（gozero, goZero, GoZero, go_zero）
#   -t, --table TABLE    仅生成指定的表（逗号分隔）
#   --db-type TYPE       指定数据库类型（mysql, postgres, mongo）
#   --dry-run            预览模式（不实际生成文件）
#   -h, --help           显示帮助信息

# ============================================
# API 生成脚本使用
# ============================================
# 基本用法：
#   sh generate/api.sh                    # 使用默认配置
#   sh generate/api.sh -f api/user.api   # 指定 API 文件
#   sh generate/api.sh --validate        # 仅验证语法
#   sh generate/api.sh -s goZero         # 使用小驼峰风格
#
# 常用参数：
#   -f, --file FILE      指定 API 文件（默认: test.api）
#   -o, --output DIR     指定输出目录（默认: .）
#   -s, --style STYLE    指定命名风格
#   -v, --verbose        显示详细日志
#   --validate           仅验证语法（不生成代码）
#   -h, --help           显示帮助信息

# ============================================
# 常见问题
# ============================================
# Q: 提示 "invalid DSN" 错误？
# A: 检查 DataSource 格式，确保不包含多余的参数（如 ?charset=utf8mb4）
#    正确格式：user:password@tcp(host:port)/database

# Q: 如何切换数据库类型？
# A: 方式1：修改配置文件中的 Database.Type 字段
#    方式2：使用命令行参数 --db-type postgres

# Q: 如何测试数据库连接？
# A: 使用预览模式检查：sh generate/model.sh --dry-run
#    脚本会自动连接数据库并显示表列表

# Q: 如何只生成部分表？
# A: 使用 -t 参数：sh generate/model.sh -t user,order,product

# Q: 生成失败如何排查？
# A: 1. 查看详细错误日志（脚本会自动显示）
#    2. 确认配置文件格式正确
#    3. 使用 --dry-run 测试连接
#    4. 检查 goctl 版本：goctl --version

# Q: 是否支持连接池配置？
# A: 连接池配置应在应用代码中设置，此处只配置基本连接信息

# Q: 密码包含特殊字符怎么办？
# A: 使用 URL 编码，或用引号包裹整个 DataSource
#    示例：DataSource: "user:p@ss#word@tcp(localhost:3306)/db"

# Q: 如何查看完整的命令行帮助？
# A: sh generate/model.sh --help
#    sh generate/api.sh --help

# ============================================
# 支持的数据库
# ============================================
# MySQL      - 完全支持，自动表发现
# PostgreSQL - 完全支持，扫描 public schema
# MongoDB    - 基础支持，需预定义类型

# ============================================
# 版本信息
# ============================================
# 版本: v2.0
# 更新时间: 2025-12-24
# 新特性：
#   - 多数据库支持（MySQL、PostgreSQL、MongoDB）
#   - 自动数据库类型检测
#   - 增强的错误处理和提示
#   - DSN 格式预验证
#   - 详细的排查建议

